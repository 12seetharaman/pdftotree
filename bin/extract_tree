#!/usr/bin/env python
"""Simple commandline interface for parsing PDF to HTML."""
import argparse
import logging
import pdftotree

if __name__ == '__main__':
    parser = argparse.ArgumentParser(
        description="""Script to extract tree structure from PDF files.""")
    parser.add_argument(
        '--model_path', type=str, default=None, help='pretrained model')
    parser.add_argument(
        '--pdf_file',
        type=str,
        required=True,
        help='pdf file name for which tree structure needs to be extracted')
    parser.add_argument(
        '--html_path',
        type=str,
        help=
        'path where tree structure should be saved. If none, HTML is printed to stdout.'
    )
    parser.add_argument(
        '--favor_figures',
        type=str,
        help=
        'whether figures must be favored over other parts such as tables and section headers',
        default="True")
    parser.add_argument(
        '--visualize',
        dest="visualize",
        action="store_true",
        help='whether to output visualization images for the tree')
    parser.add_argument(
        '-v',
        dest="verbose",
        action="store_true",
        help='output INFO level logging.')
    parser.add_argument(
        '-vv',
        dest="debug",
        action="store_true",
        help='output DEBUG level logging.')
    parser.set_defaults(visualize=False)
    args = parser.parse_args()

    if args.debug:
        log_level = logging.DEBUG
    elif args.verbose:
        log_level = logging.INFO
    else:
        log_level = logging.ERROR

    # Configure logging for this application
    log = logging.getLogger('pdftotree')
    log.setLevel(log_level)

    ch = logging.StreamHandler()
    ch.setLevel(log_level)

    formatter = logging.Formatter("[%(levelname)s] %(name)s - %(message)s")
    ch.setFormatter(formatter)

    log.addHandler(ch)

    # Call the main routine
    result = pdftotree.parse(args.pdf_file, args.html_path, args.model_path,
                             args.favor_figures, args.visualize)

    if args.html_path is None:
        print(result)
